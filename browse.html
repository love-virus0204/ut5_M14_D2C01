<!doctype html>
<html lang="zh-Hant">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>D2大夜班跨加報名名單</title>
<style>
:root{
  --bg:#0b1220;--panel:#1a2333cc;--text:#e5e7eb;--sub:#94a3b8;--accent:#22d3ee;
  --ok:#22c55e;--ng:#ef4444;--glass:#1f2937aa;--shadow:0 4px 20px rgba(0,0,0,.35);
}
html,body{margin:0;height:100%;background:var(--bg);color:var(--text);
font-family:system-ui,"Microsoft JhengHei",sans-serif;overflow-x:hidden;}
.container{display:flex;flex-direction:column;align-items:center;justify-content:flex-start;min-height:100vh;padding:20px;}
h1{font-size:20px;letter-spacing:.1em;margin:10px 0 16px;text-align:center;color:var(--accent);}
.table-wrap{background:var(--panel);border-radius:12px;padding:16px 10px;width:min(640px,94vw);
box-shadow:var(--shadow);}
.header-row{display:grid;grid-template-columns:1fr 1fr;text-align:center;color:var(--sub);
font-size:14px;margin-bottom:6px;}
.row{display:grid;grid-template-columns:1fr 1fr;border-bottom:1px solid #1f2937;padding:6px 0;
font-size:15px;text-align:center;}
.row:last-child{border-bottom:0;}
.cell{padding:2px 6px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}
.cell.left{color:#7dd3fc;} .cell.right{color:#fcd34d;}
footer{margin-top:14px;font-size:12px;color:var(--sub);text-align:center;}
.spinner{border:4px solid rgba(255,255,255,.2);border-top:4px solid var(--accent);
border-radius:50%;width:42px;height:42px;animation:spin 1s linear infinite;margin:60px auto;}
@keyframes spin{to{transform:rotate(360deg)}}
.hidden{display:none;}
button.refresh{margin-top:10px;padding:8px 16px;border:0;border-radius:8px;
background:linear-gradient(180deg,#2563eb,#1e3a8a);color:#fff;font-weight:600;cursor:pointer;}
button.refresh:hover{background:linear-gradient(180deg,#3b82f6,#1e3a8a);}
</style>
</head>
<body>
<div class="container">
  <h1>D2大夜班跨加報名名單</h1>
  <div id="loading" class="spinner"></div>
  <div id="tableBox" class="table-wrap hidden">
    <div class="header-row"><div>A 班</div><div>B 班</div></div>
    <div id="rows"></div>
  </div>
  <button class="refresh" onclick="loadData()">重新整理</button>
  <footer>版本 v0.2　|　更新：<span id="updateTime">--/-- --:--:--</span></footer>
</div>

<script>
const API_URL='https://script.google.com/macros/s/AKfycbw1jdsG18FEoO2x-CgkOUXdFIpotUy3xJsJQBKf-FKuFQyKt2DLqLShtBuxNwoOjynj/exec';
const TZ='Asia/Taipei';

function fmtTime(){
  const d=new Date();
  return new Intl.DateTimeFormat('zh-Hant-TW',{timeZone:TZ,month:'2-digit',day:'2-digit',hour:'2-digit',minute:'2-digit'}).format(d);
}

async function loadData(){
  document.getElementById('loading').classList.remove('hidden');
  document.getElementById('tableBox').classList.add('hidden');
  const params=new URLSearchParams({action:'list_recent'});
  try{
    const r=await fetch(API_URL,{method:'POST',body:params});
    const t=await r.text();
    const j=JSON.parse(t);
    renderTable(j);
  }catch(e){
    document.getElementById('rows').innerHTML=`<div class="row"><div class="cell">讀取失敗</div><div class="cell"></div></div>`;
    document.getElementById('tableBox').classList.remove('hidden');
  }
  document.getElementById('loading').classList.add('hidden');
  document.getElementById('tableBox').classList.remove('hidden');
  document.getElementById('updateTime').textContent=fmtTime();
}

function renderTable(data){
  if(!Array.isArray(data)||!data.length){
    document.getElementById('rows').innerHTML=`<div class="row"><div class="cell">目前無資料</div><div class="cell"></div></div>`;
    return;
  }
  const A=data.filter(x=>String(x.shift).toUpperCase()==='A');
  const B=data.filter(x=>String(x.shift).toUpperCase()==='B');
  const max=Math.max(A.length,B.length);
  let html='';
  for(let i=0;i<max;i++){
    const a=A[i]?`${A[i].id}, ${A[i].dN}`:'';
    const b=B[i]?`${B[i].id}, ${B[i].dN}`:'';
    html+=`<div class="row"><div class="cell left">${a}</div><div class="cell right">${b}</div></div>`;
  }
  document.getElementById('rows').innerHTML=html;
}

document.addEventListener('DOMContentLoaded',loadData);
</script>
</body>
</html>