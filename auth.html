<!doctype html>
<html lang="zh-Hant">
<head>
<script src="./config.js"></script>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">
<title>ID與設備驗證</title>
<style>
:root{
  --bg:#0a0a0f;--panel:#111827;--accent:#00fff0;--text:#e5e7eb;--sub:#9ca3af;
}
html,body{
  height:100%;margin:0;
  background:#000;
  color:var(--text);
  font-family:system-ui,"PingFang TC","Microsoft JhengHei",sans-serif;
  display:flex;justify-content:center;
  align-items:flex-start;
  padding-top:8vh;
}

.container{
 width:90%;max-width:380px;min-width:240px;
  padding:32px 24px;border-radius:20px;
  background:var(--panel);
  box-shadow:0 0 20px rgba(0,255,240,.2);
  animation:glow 2s infinite ease-in-out alternate;
  text-align:center;
}
@keyframes glow{
  0%{box-shadow:0 0 14px rgba(0,255,240,.2);}
  100%{box-shadow:0 0 30px rgba(0,255,240,.6);}
}
h1{font-size:20px;letter-spacing:.1em;margin-bottom:24px;color:var(--accent);}
input{
  width:80%;max-width:240px;height:44px;
  margin:8px 0;padding:0 10px;
  border-radius:8px;border:1px solid #334155;
  background:#0f172a;color:var(--text);
  font-size:16px;text-align:center;
}
button{
  width:120px;height:44px;margin-top:20px;
  border-radius:10px;border:1px solid var(--accent);
  background:linear-gradient(180deg,#06b6d4,#0ea5e9);
  color:#fff;font-weight:700;letter-spacing:.05em;
  cursor:pointer;transition:all .2s ease;
}
button:hover{filter:brightness(1.2);}
.overlay{
  position:fixed;inset:0;display:none;
  background:rgba(0,0,0,.5);
  align-items:center;justify-content:center;
  z-index:99;
}
.spinner{
  width:50px;height:50px;border-radius:50%;
  border:4px solid rgba(255,255,255,.3);
  border-top-color:var(--accent);
  animation:spin 1s linear infinite;
}
@keyframes spin{to{transform:rotate(360deg);}}
.msg{margin-top:12px;font-size:14px;color:var(--sub);}
</style>
</head>
<body>
<div class="container">
  <h1>組織認證入口</h1>
  <input id="uid" placeholder="輸入5碼帳號" maxlength="5" inputmode="latin">
  <br>
  <input id="pwd" placeholder="輸入密碼" type="password" minlength="4" maxlength="10">
  <br>
  <button id="loginBtn">驗　證</button>
  <div class="msg" id="msg"></div>
</div>
<div class="overlay" id="overlay"><div class="spinner"></div></div>
<script>
const overlay=document.getElementById('overlay');
const msg=document.getElementById('msg');
function showOverlay(on){overlay.style.display=on?'flex':'none';}
function saveUser(u){localStorage.setItem('user_id',u);}
async function verify(){
  const uid=document.getElementById('uid').value.trim().toUpperCase();
  const pwd=document.getElementById('pwd').value.trim();
  if(!/^[A-Z0-9]{5}$/.test(uid)){msg.textContent="帳號格式錯誤";return;}
  if(!/^[A-Za-z0-9]{4,10}$/.test(pwd)){msg.textContent="密碼格式錯誤";return;}
  showOverlay(true);msg.textContent="";
  const p=new URLSearchParams({action:"login",id:uid,pwd});
  try{
    const r=await fetch(api_url,{method:"POST",body:p});
    const j=await r.json();
    showOverlay(false);
    if(j.status==="ok"){
      msg.style.color="#22c55e";msg.textContent="驗證成功，3s 後將關閉...";
      saveUser(uid);
      setTimeout(()=>window.close(),3000);
    }else if(j.status==="wrong_pwd"){
      msg.style.color="#ef4444";msg.textContent="密碼錯誤";
      document.getElementById('pwd').value="";
    }else{
      msg.style.color="#facc15";msg.textContent="伺服器錯誤";
    }
  }catch(_){
    showOverlay(false);
    msg.style.color="#facc15";msg.textContent="網路連線失敗";
  }
}
document.getElementById('loginBtn').addEventListener('click',verify);
</script>
</body>
</html>