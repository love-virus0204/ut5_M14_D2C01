<!doctype html>
<meta charset="utf-8">
<title>GAS submit 一鍵測試</title>
<button id="go">一鍵送出</button>
<pre id="out"></pre>
<script>
const API_URL="https://script.google.com/macros/s/AKfycbw1jdsG18FEoO2x-CgkOUXdFIpotUy3xJsJQBKf-FKuFQyKt2DLqLShtBuxNwoOjynj/exec";
const TZ="Asia/Taipei";

function genID(){return Array.from({length:5},()=> "ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789"[Math.random()*36|0]).join("");}
function mmddWithRule(){
  const now=new Date();
  const h=parseInt(new Intl.DateTimeFormat('zh-Hant-TW',{timeZone:TZ,hour:'2-digit'}).format(now),10);
  const base=new Date(now); if(h>=1) base.setDate(base.getDate()+1);
  const p=new Intl.DateTimeFormat('zh-Hant-TW',{timeZone:TZ,month:'2-digit',day:'2-digit'}).formatToParts(base)
    .reduce((a,b)=>(a[b.type]=b.value,a),{});
  return `${p.month}${p.day}`;
}

document.getElementById('go').onclick=async()=>{
  const id=genID();
  const date=mmddWithRule();
  const payload={ action:'submit', key:`${date}|${ID}`, date, id, shift:'中', dN:'2' };
  const body=new URLSearchParams(payload); // x-www-form-urlencoded

  try{
    const r=await fetch(API_URL,{method:'POST',body});
    document.getElementById('out').textContent=await r.text();
  }catch(e){
    document.getElementById('out').textContent=String(e);
  }
};
</script>